<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>「マグネットポンプ」異常対応チェックリスト</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">「マグネットポンプ」異常対応チェックリスト</h1>
        <div id="checklist-container"></div>
        <div class="mt-3 text-center">
            <button id="prev-btn" class="btn btn-secondary">戻る</button>
            <button id="next-btn" class="btn btn-primary">次へ</button>
            <button id="print-btn" class="btn btn-info" disabled>結果を印刷/PDF化</button>
            <button id="exit-btn" class="btn btn-danger">終了</button>
        </div>
    </div>
    <div id="printable-area" class="d-none"></div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        const checklistData = [
            {"phase": 1, "phase_title": "Phase 1: 異常検知・緊急停止", "type": "checklist", "category": "異常検知", "item": "ポンプが揚液しない、または吐出量が著しく少ない", "item_id": "1_0", "linked_item_id": ""},
            {"phase": 1, "phase_title": "Phase 1: 異常検知・緊急停止", "type": "checklist", "category": "異常検知", "item": "モーターは回転しているが、ポンプから送液されていない（空回り）", "item_id": "1_1", "linked_item_id": ""},
            {"phase": 1, "phase_title": "Phase 1: 異常検知・緊急停止", "type": "checklist", "category": "異常検知", "item": "ポンプ本体またはモーターから異音がする（擦れ音、ガラガラ音）", "item_id": "1_2", "linked_item_id": ""},
            {"phase": 1, "phase_title": "Phase 1: 異常検知・緊急停止", "type": "checklist", "category": "異常検知", "item": "ポンプ本体またはモーターに異常な振動がある", "item_id": "1_3", "linked_item_id": ""},
            {"phase": 1, "phase_title": "Phase 1: 異常検知・緊急停止", "type": "checklist", "category": "異常検知", "item": "ポンプ本体が異常に発熱している", "item_id": "1_4", "linked_item_id": ""},
            {"phase": 1, "phase_title": "Phase 1: 異常検知・緊急停止", "type": "checklist", "category": "異常検知", "item": "ポンプケーシングや配管接続部から液漏れがある", "item_id": "1_5", "linked_item_id": ""},
            {"phase": 1, "phase_title": "Phase 1: 異常検知・緊急停止", "type": "checklist", "category": "異常検知", "item": "モーターが過負荷（オーバーロード）で停止する", "item_id": "1_6", "linked_item_id": ""},
            {"phase": 1, "phase_title": "Phase 1: 異常検知・緊急停止", "type": "checklist", "category": "異常検知", "item": "圧力計、流量計の指示値が異常である", "item_id": "1_7", "linked_item_id": ""},
            {"phase": 1, "phase_title": "Phase 1: 異常検知・緊急停止", "type": "checklist", "category": "異常検知", "item": "その他", "item_id": "1_8", "linked_item_id": ""},
            {"phase": 1, "phase_title": "Phase 1: 異常検知・緊急停止", "type": "checklist", "category": "緊急停止措置", "item": "ポンプの非常停止ボタンを押す", "item_id": "1_9", "linked_item_id": ""},
            {"phase": 1, "phase_title": "Phase 1: 異常検知・緊急停止", "type": "checklist", "category": "緊急停止措置", "item": "主電源（ブレーカー）を遮断する", "item_id": "1_10", "linked_item_id": ""},
            {"phase": 1, "phase_title": "Phase 1: 異常検知・緊急停止", "type": "checklist", "category": "緊急停止措置", "item": "電源遮断箇所にロックアウト/タグアウトを実施する", "item_id": "1_11", "linked_item_id": ""},
            {"phase": 1, "phase_title": "Phase 1: 異常検知・緊急停止", "type": "checklist", "category": "緊急停止措置", "item": "ポンプ前後のバルブ（吸込側、吐出側）を閉止する", "item_id": "1_12", "linked_item_id": ""},
            {"phase": 1, "phase_title": "Phase 1: 異常検知・緊急停止", "type": "checklist", "category": "緊急停止措置", "item": "関連部署およびメンテナンス部門に異常発生を報告する", "item_id": "1_13", "linked_item_id": ""},
            {"phase": 2, "phase_title": "Phase 2-1: 故障原因調査（使用部門）", "type": "checklist_with_status", "category": "運転状況", "item": "タンク液切れによる空運転が発生した", "item_id": "2_0", "linked_item_id": ""},
            {"phase": 2, "phase_title": "Phase 2-1: 故障原因調査（使用部門）", "type": "checklist_with_status", "category": "運転状況", "item": "吸込側のバルブが閉じている、または開き度が不足している", "item_id": "2_1", "linked_item_id": ""},
            {"phase": 2, "phase_title": "Phase 2-1: 故障原因調査（使用部門）", "type": "checklist_with_status", "category": "運転状況", "item": "吐出側のバルブが全閉のまま運転している", "item_id": "2_2", "linked_item_id": ""},
            {"phase": 2, "phase_title": "Phase 2-1: 故障原因調査（使用部門）", "type": "checklist_with_status", "category": "運転状況", "item": "吸込配管からエアを吸い込んでいる（エア噛み）", "item_id": "2_3", "linked_item_id": ""},
            {"phase": 2, "phase_title": "Phase 2-1: 故障原因調査（使用部門）", "type": "checklist_with_status", "category": "運転状況", "item": "吸込ストレーナーが目詰まりしている", "item_id": "2_4", "linked_item_id": ""},
            {"phase": 2, "phase_title": "Phase 2-1: 故障原因調査（使用部門）", "type": "checklist_with_status", "category": "運転状況", "item": "移送液に固形物（スラリー）や金属片が混入している", "item_id": "2_5", "linked_item_id": ""},
            {"phase": 2, "phase_title": "Phase 2-1: 故障原因調査（使用部門）", "type": "checklist_with_status", "category": "運転状況", "item": "移送液の粘度や比重が仕様範囲を超えている", "item_id": "2_6", "linked_item_id": ""},
            {"phase": 3, "phase_title": "Phase 3-1: 対策実施（使用部門）", "type": "checklist_with_status", "category": "運転状況", "item": "タンクに薬液を補充し、空運転を防止する", "item_id": "3_0", "linked_item_id": "2_0"},
            {"phase": 3, "phase_title": "Phase 3-1: 対策実施（使用部門）", "type": "checklist_with_status", "category": "運転状況", "item": "吸込側のバルブを全開にする", "item_id": "3_1", "linked_item_id": "2_1"},
            {"phase": 3, "phase_title": "Phase 3-1: 対策実施（使用部門）", "type": "checklist_with_status", "category": "運転状況", "item": "吐出側のバルブを適切な開度に調整する", "item_id": "3_2", "linked_item_id": "2_2"},
            {"phase": 3, "phase_title": "Phase 3-1: 対策実施（使用部門）", "type": "checklist_with_status", "category": "運転状況", "item": "吸込配管の接続部を増し締めし、エアの吸い込みを止める", "item_id": "3_3", "linked_item_id": "2_3"},
            {"phase": 3, "phase_title": "Phase 3-1: 対策実施（使用部門）", "type": "checklist_with_status", "category": "運転状況", "item": "吸込ストレーナーを清掃する", "item_id": "3_4", "linked_item_id": "2_4"},
            {"phase": 3, "phase_title": "Phase 3-1: 対策実施（使用部門）", "type": "checklist_with_status", "category": "運転状況", "item": "移送液中の固形物を除去する対策を講じる", "item_id": "3_5", "linked_item_id": "2_5"},
            {"phase": 3, "phase_title": "Phase 3-1: 対策実施（使用部門）", "type": "checklist_with_status", "category": "運転状況", "item": "移送液の粘度や比重を仕様範囲内に収まるよう管理する", "item_id": "3_6", "linked_item_id": "2_6"},
            {"phase": 4, "phase_title": "Phase 2-2: 故障原因調査（メンテナンス部門）", "type": "checklist_with_status", "category": "モーター・動力", "item": "モーターの回転方向が逆である", "item_id": "4_0", "linked_item_id": ""},
            {"phase": 4, "phase_title": "Phase 2-2: 故障原因調査（メンテナンス部門）", "type": "checklist_with_status", "category": "モーター・動力", "item": "電源の欠相、または電圧が低下している", "item_id": "4_1", "linked_item_id": ""},
            {"phase": 4, "phase_title": "Phase 2-2: 故障原因調査（メンテナンス部門）", "type": "checklist_with_status", "category": "モーター・動力", "item": "モーターの過負荷保護装置（サーマルリレー）が作動している", "item_id": "4_2", "linked_item_id": ""},
            {"phase": 4, "phase_title": "Phase 2-2: 故障原因調査（メンテナンス部門）", "type": "checklist_with_status", "category": "マグネットカップリング", "item": "インナーマグネットとアウターマグネットがカップリングアウト（脱調）している", "item_id": "4_3", "linked_item_id": ""},
            {"phase": 4, "phase_title": "Phase 2-2: 故障原因調査（メンテナンス部門）", "type": "checklist_with_status", "category": "マグネットカップリング", "item": "マグネットが割れている、または腐食している", "item_id": "4_4", "linked_item_id": ""},
            {"phase": 4, "phase_title": "Phase 2-2: 故障原因調査（メンテナンス部門）", "type": "checklist_with_status", "category": "ポンプ内部部品", "item": "インペラ（羽根車）が摩耗または破損している", "item_id": "4_5", "linked_item_id": ""},
            {"phase": 4, "phase_title": "Phase 2-2: 故障原因調査（メンテナンス部門）", "type": "checklist_with_status", "category": "ポンプ内部部品", "item": "スピンドル（主軸）が摩耗または折損している", "item_id": "4_6", "linked_item_id": ""},
            {"phase": 4, "phase_title": "Phase 2-2: 故障原因調査（メンテナンス部門）", "type": "checklist_with_status", "category": "ポンプ内部部品", "item": "軸受（ベアリング）が摩耗または破損している", "item_id": "4_7", "linked_item_id": ""},
            {"phase": 4, "phase_title": "Phase 2-2: 故障原因調査（メンテナンス部門）", "type": "checklist_with_status", "category": "ポンプ内部部品", "item": "スラスト受けが摩耗または破損している", "item_id": "4_8", "linked_item_id": ""},
            {"phase": 4, "phase_title": "Phase 2-2: 故障原因調査（メンテナンス部門）", "type": "checklist_with_status", "category": "ポンプ内部部品", "item": "リアケーシング（マグネットカプセル）が熱や圧力で変形・破損している", "item_id": "4_9", "linked_item_id": ""},
            {"phase": 4, "phase_title": "Phase 2-2: 故障原因調査（メンテナンス部門）", "type": "checklist_with_status", "category": "ポンプ内部部品", "item": "Oリングやガスケットが劣化・損傷している", "item_id": "4_10", "linked_item_id": ""},
            {"phase": 5, "phase_title": "Phase 3-2: 対策実施（メンテナンス部門）", "type": "checklist_with_status", "category": "モーター・動力", "item": "モーターの結線を修正し、正しい回転方向にする", "item_id": "5_0", "linked_item_id": "4_0"},
            {"phase": 5, "phase_title": "Phase 3-2: 対策実施（メンテナンス部門）", "type": "checklist_with_status", "category": "モーター・動力", "item": "電源系統を点検し、規定電圧を確保する", "item_id": "5_1", "linked_item_id": "4_1"},
            {"phase": 5, "phase_title": "Phase 3-2: 対策実施（メンテナンス部門）", "type": "checklist_with_status", "category": "モーター・動力", "item": "過負荷の原因（固着、粘度上昇等）を調査・除去し、サーマルリレーをリセットする", "item_id": "5_2", "linked_item_id": "4_2"},
            {"phase": 5, "phase_title": "Phase 3-2: 対策実施（メンテナンス部門）", "type": "checklist_with_status", "category": "マグネットカップリング", "item": "過負荷や固着の原因を除去後、一度ポンプを停止し再起動する", "item_id": "5_3", "linked_item_id": "4_3"},
            {"phase": 5, "phase_title": "Phase 3-2: 対策実施（メンテナンス部門）", "type": "checklist_with_status", "category": "マグネットカップリング", "item": "インナーマグネットまたはアウターマグネットを交換する", "item_id": "5_4", "linked_item_id": "4_4"},
            {"phase": 5, "phase_title": "Phase 3-2: 対策実施（メンテナンス部門）", "type": "checklist_with_status", "category": "ポンプ内部部品", "item": "インペラを交換する", "item_id": "5_5", "linked_item_id": "4_5"},
            {"phase": 5, "phase_title": "Phase 3-2: 対策実施（メンテナンス部門）", "type": "checklist_with_status", "category": "ポンプ内部部品", "item": "スピンドルを交換する", "item_id": "5_6", "linked_item_id": "4_6"},
            {"phase": 5, "phase_title": "Phase 3-2: 対策実施（メンテナンス部門）", "type": "checklist_with_status", "category": "ポンプ内部部品", "item": "軸受（ベアリング）を交換する", "item_id": "5_7", "linked_item_id": "4_7"},
            {"phase": 5, "phase_title": "Phase 3-2: 対策実施（メンテナンス部門）", "type": "checklist_with_status", "category": "ポンプ内部部品", "item": "スラスト受けを交換する", "item_id": "5_8", "linked_item_id": "4_8"},
            {"phase": 5, "phase_title": "Phase 3-2: 対策実施（メンテナンス部門）", "type": "checklist_with_status", "category": "ポンプ内部部品", "item": "リアケーシングを交換する", "item_id": "5_9", "linked_item_id": "4_9"},
            {"phase": 5, "phase_title": "Phase 3-2: 対策実施（メンテナンス部門）", "type": "checklist_with_status", "category": "ポンプ内部部品", "item": "Oリングやガスケットを交換する", "item_id": "5_10", "linked_item_id": "4_10"},
            {"phase": 6, "phase_title": "Phase 4: 再起動前準備", "type": "checklist_with_status", "category": "安全確認", "item": "ロックアウト/タグアウトが解除されていることを確認する", "item_id": "6_0", "linked_item_id": ""},
            {"phase": 6, "phase_title": "Phase 4: 再起動前準備", "type": "checklist_with_status", "category": "復旧確認", "item": "修理・交換箇所に問題がないことを目視で確認する", "item_id": "6_1", "linked_item_id": ""},
            {"phase": 6, "phase_title": "Phase 4: 再起動前準備", "type": "checklist_with_status", "category": "復旧確認", "item": "ポンプケーシングのボルトが均等に締め付けられていることを確認する", "item_id": "6_2", "linked_item_id": ""},
            {"phase": 6, "phase_title": "Phase 4: 再起動前準備", "type": "checklist_with_status", "category": "系統確認", "item": "ポンプ前後のバルブが規定の位置にあることを確認する（吸込側：開、吐出側：閉または少し開）", "item_id": "6_3", "linked_item_id": ""},
            {"phase": 6, "phase_title": "Phase 4: 再起動前準備", "type": "checklist_with_status", "category": "初期充填", "item": "ポンプケーシング内に移送液を完全に満たし、エア抜きを確実に行う（呼び液）", "item_id": "6_4", "linked_item_id": ""},
            {"phase": 6, "phase_title": "Phase 4: 再起動前準備", "type": "checklist_with_status", "category": "手動確認", "item": "アウターマグネットを手で回し、インペラがスムーズに回転し、固着や接触音がないことを確認する", "item_id": "6_5", "linked_item_id": ""},
            {"phase": 7, "phase_title": "Phase 5: 試運転・正規運転", "type": "checklist_with_status", "category": "インチング運転", "item": "電源を瞬間的に投入・遮断し、モーターの回転方向が正しいことを確認する", "item_id": "7_0", "linked_item_id": ""},
            {"phase": 7, "phase_title": "Phase 5: 試運転・正規運転", "type": "checklist_with_status", "category": "短時間試運転", "item": "吐出側バルブを少し開いた状態でポンプを起動し、異音、異常振動、液漏れがないことを確認する", "item_id": "7_1", "linked_item_id": ""},
            {"phase": 7, "phase_title": "Phase 5: 試運転・正規運転", "type": "checklist_with_status", "category": "短時間試運転", "item": "ポンプ本体の温度が急上昇しないことを確認する", "item_id": "7_2", "linked_item_id": ""},
            {"phase": 7, "phase_title": "Phase 5: 試運転・正規運転", "type": "checklist_with_status", "category": "負荷運転", "item": "吐出側のバルブを徐々に開き、負荷をかける", "item_id": "7_3", "linked_item_id": ""},
            {"phase": 7, "phase_title": "Phase 5: 試運転・正規運転", "type": "checklist_with_status", "category": "負荷運転", "item": "吐出圧力、流量が規定値に達することを確認する", "item_id": "7_4", "linked_item_id": ""},
            {"phase": 7, "phase_title": "Phase 5: 試運転・正規運転", "type": "checklist_with_status", "category": "負荷運転", "item": "電流値が定格範囲内であることを測定・確認する", "item_id": "7_5", "linked_item_id": ""},
            {"phase": 7, "phase_title": "Phase 5: 試運転・正規運転", "type": "checklist_with_status", "category": "正規運転", "item": "各種計器類（圧力、電流値、温度、異音・振動の有無）が安定していることを確認し、正規運転に移行する", "item_id": "7_6", "linked_item_id": ""},
            {"phase": 7, "phase_title": "Phase 5: 試運転・正規運転", "type": "checklist_with_status", "category": "正規運転", "item": "運転記録（圧力、電流値、温度、異音・振動の有無）を記録する", "item_id": "7_7", "linked_item_id": ""}
        ];

        // --- ここから汎用ロジック ---
        (function() {
            // URLからパラメータを取得する互換性対応関数
            function getQueryParam(param) {
                var href = window.location.href;
                var name = param.replace(/[[]]/g, '\$&');
                var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
                var results = regex.exec(href);
                if (!results) return null;
                if (!results[2]) return '';
                return decodeURIComponent(results[2].replace(/+/g, ' '));
            }

            // アクセス制御とキー引き継ぎ
            var SECRET_KEY = "93SYa4oyAeTbhKaC1Cj3hA";
            var currentKey = getQueryParam('key');

            if (currentKey !== SECRET_KEY) {
                document.body.innerHTML = '<div style="text-align: center; padding-top: 50px; font-family: sans-serif;"><h1>アクセス権がありません</h1><p>このページは指定された場所からのみアクセスできます。</p></div>';
                return; // アクセスが不正な場合は、以降の処理をすべて中断
            }

            // キー引き継ぎのため、ページ内の全リンクを更新
            var links = document.getElementsByTagName('a');
            for (var i = 0; i < links.length; i++) {
                var link = links[i];
                var href = link.getAttribute('href');
                if (href && href.indexOf('.html') !== -1 && href.indexOf('http') !== 0) {
                    link.href = href + '?key=' + currentKey;
                }
            }

            // --- チェックリストアプリのメインロジック ---
            var currentPhase = 1;
            var userSelections = {};
            var fileName = window.location.pathname.split("/").pop();
            var selectionKey = 'userSelections_' + fileName;
            var phaseKey = 'currentPhase_' + fileName;

            // 初期化
            function initialize() {
                var storedSelections = sessionStorage.getItem(selectionKey);
                if (storedSelections) {
                    userSelections = JSON.parse(storedSelections);
                }
                var storedPhase = sessionStorage.getItem(phaseKey);
                if (storedPhase) {
                    currentPhase = parseInt(storedPhase, 10);
                }
                renderPhase(currentPhase);
            }

            // 画面描画
            function renderPhase(phase) {
                var container = $('#checklist-container');
                container.empty();
                var phaseData = checklistData.filter(function(item) { return parseInt(item.phase) === phase; });
                if (phaseData.length === 0) {
                    container.append('<p>このフェーズの項目はありません。</p>');
                    updateNavigation();
                    return;
                }
                
                var phaseTitle = phaseData[0].phase_title;
                container.append('<h2 class="phase-title">' + phaseTitle + '</h2>');

                var itemsToShow = phaseData;
                if (phase === 3 || phase === 5) {
                    var linkedPhase = phase === 3 ? 2 : 4;
                    var problemItemIds = [];
                    for (var key in userSelections) {
                        if (userSelections[key].phase === linkedPhase && userSelections[key].value === '問題あり') {
                            problemItemIds.push(userSelections[key].id);
                        }
                    }
                    itemsToShow = phaseData.filter(function(item) { return problemItemIds.indexOf(item.linked_item_id) !== -1; });
                }

                if (itemsToShow.length === 0 && (phase === 3 || phase === 5)) {
                    container.append('<p>前のフェーズで「問題あり」とされた項目はありません。次へ進んでください。</p>');
                } else {
                    var groupedByCategory = itemsToShow.reduce(function(acc, item) {
                        (acc[item.category] = acc[item.category] || []).push(item);
                        return acc;
                    }, {});

                    for (var category in groupedByCategory) {
                        container.append('<h4 class="category-title">' + category + '</h4>');
                        groupedByCategory[category].forEach(function(item) {
                            container.append(createItemHtml(item, phase));
                        });
                    }
                }
                updateNavigation();
            }

            // 項目HTML生成
            function createItemHtml(item, phase) {
                var itemKey = item.item_id;
                var savedValue = userSelections[itemKey] ? userSelections[itemKey].value : undefined;
                var inputs = '';

                if (item.type === 'checklist') {
                    var isChecked = savedValue === 'checked';
                    inputs = '<input type="checkbox" class="form-check-input" data-item-key="' + itemKey + '" ' + (isChecked ? 'checked' : '') + '>';
                } else {
                    var options = (phase === 2 || phase === 4) ? ['問題なし', '問題あり'] : ['実施済み', '非該当'];
                    var colors = (phase === 2 || phase === 4) ? ['success', 'danger'] : ['primary', 'secondary'];
                    inputs += '<div class="btn-group btn-group-toggle" data-toggle="buttons">';
                    for (var i = 0; i < options.length; i++) {
                        var isActive = savedValue === options[i];
                        inputs += '<label class="btn btn-outline-' + colors[i] + ' ' + (isActive ? 'active' : '') + '"><input type="radio" name="' + itemKey + '" value="' + options[i] + '" ' + (isActive ? 'checked' : '') + '> ' + options[i] + '</label>';
                    }
                    inputs += '</div>';
                }
                return '<div class="checklist-item-row"><label class="item-label">' + item.item + '</label><div>' + inputs + '</div></div>';
            }

            // ナビゲーション更新
            function updateNavigation() {
                var totalPhases = Math.max.apply(Math, checklistData.map(function(item) { return parseInt(item.phase); }));
                $('#prev-btn').toggle(currentPhase > 1);
                $('#next-btn').toggle(currentPhase < totalPhases);

                // 「次へ」ボタンの有効化/無効化
                var phaseItems = checklistData.filter(function(item) { return parseInt(item.phase) === currentPhase; });
                var allAnswered = phaseItems.every(function(item) { return userSelections[item.item_id]; });
                $('#next-btn').prop('disabled', !allAnswered);

                // 「印刷」ボタンの有効化/無効化
                var phase3Items = checklistData.filter(function(item) { return parseInt(item.phase) === 3; });
                var allPhase3Answered = phase3Items.every(function(item) { return userSelections[item.item_id]; });
                $('#print-btn').prop('disabled', !(currentPhase >= 3 && allPhase3Answered));
            }

            // イベントハンドラ
            $('#checklist-container').on('change', 'input', function() {
                var key = this.name || $(this).data('item-key');
                var value = $(this).is(':checkbox') ? (this.checked ? 'checked' : 'unchecked') : this.value;
                userSelections[key] = { value: value, id: key, phase: currentPhase };
                sessionStorage.setItem(selectionKey, JSON.stringify(userSelections));
                updateNavigation();
            });

            $('#next-btn').click(function() {
                var totalPhases = Math.max.apply(Math, checklistData.map(function(item) { return parseInt(item.phase); }));
                if (currentPhase < totalPhases) {
                    currentPhase++;
                    sessionStorage.setItem(phaseKey, currentPhase.toString());
                    renderPhase(currentPhase);
                }
            });

            $('#prev-btn').click(function() {
                if (currentPhase > 1) {
                    currentPhase--;
                    sessionStorage.setItem(phaseKey, currentPhase.toString());
                    renderPhase(currentPhase);
                }
            });

            $('#exit-btn').click(function() {
                if (confirm('メインメニューに戻りますか？\n(入力内容は保存されます)')) {
                    window.location.href = 'index.html?key=' + currentKey;
                }
            });
            
            $('#print-btn').click(function() {
                // 印刷ロジック（後述）
            });

            initialize();
        })();
    </script>
</body>
</html>